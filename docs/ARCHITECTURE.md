# Project Architecture & Technical Documentation

## Overview

This document provides a comprehensive technical overview of the Remote Expense Tracker project, including backend and frontend structure, API reference, dependencies, and implementation notes. It is intended for developers, maintainers, and contributors.

---

## Backend Structure (`/backend/src`)

### **server.js**
- Main Express app entry point. Sets up middleware, routes, error handling, and static file serving.

### **routes/**
- **expenses.js**: All expense CRUD, status update, and export endpoints. Handles file uploads (receipts), RBAC, and validation.
- **analytics.js**: Analytics endpoints (summary, category breakdown, trends). Role-based: admin sees all, employee sees own.
- **audit.js**: Audit log endpoints (list, stats, export). Admin only.
- **users.js**: User management endpoints (CRUD, admin only).
- **auth.js**: Auth endpoints (login, logout, get current user info).

### **middleware/**
- **auth.js**: JWT authentication, RBAC, and role checks (admin/employee).
- **validation.js**: Zod-based request validation for all major routes.
- **errorHandler.js**: Centralized error handling middleware.

### **prisma/**
- **schema.prisma**: Database schema (PostgreSQL, Prisma ORM).
- **migrations/**: All DB migrations (auto-generated by Prisma).
- **seed.js**: Seed script for initial data (admin, employee, sample expenses).

### **uploads/**
- Directory for uploaded receipts (images, PDFs). Served as static files.

---

## Frontend Structure (`/frontend/src`)

### **App.tsx**
- Main React router and layout. Handles route protection and layout.

### **pages/**
- **Dashboard.tsx**: Dashboard with role-based stats (admin: all, employee: own).
- **Expenses.tsx**: Expense management (list, create, edit, filter, upload receipt).
- **Analytics.tsx**: Analytics dashboard (admin only).
- **AuditLogs.tsx**: Audit log viewer (admin only).
- **Users.tsx**: User management (admin only).
- **Login.tsx**: Login page (JWT auth).
- **TestUser.tsx**: Debug/test page for current user and login state.

### **components/**
- **Layout.tsx**: Main sidebar/topbar layout, role badge, navigation.
- **ProtectedRoute.tsx**: Route guard for authentication.

### **contexts/**
- **AuthContext.tsx**: Auth state, login/logout, user info, token management.

### **services/**
- **authService.ts**: API calls for authentication (login, logout, get current user).

### **utils/**
- **api.ts**: API helper for generating receipt URLs.

### **types/**
- **index.ts**: All TypeScript types/interfaces (User, Expense, etc.).

---

## API Reference

### **Authentication**
- `POST   /api/auth/login` — Login, returns JWT and user info
- `POST   /api/auth/logout` — Logout (removes token)
- `GET    /api/auth/me` — Get current user info

### **Expenses**
- `GET    /api/expenses` — List expenses (role-based, filters)
- `POST   /api/expenses` — Create new expense (employee or admin)
- `PUT    /api/expenses/:id` — Edit expense (employee: own, admin: any)
- `PUT    /api/expenses/:id/status` — Update status (admin only, approve/reject)
- `GET    /api/expenses/export` — Export all expenses to CSV (admin only)
- `GET    /api/expenses/:id` — Get single expense (employee: own, admin: any)

### **Users (Admin Only)**
- `GET    /api/users` — List all users (pagination, search)
- `POST   /api/users` — Create user
- `PUT    /api/users/:id` — Update user
- `DELETE /api/users/:id` — Delete user (cannot delete self)
- `GET    /api/users/:id` — Get user by ID

### **Analytics**
- `GET    /api/analytics/summary` — Analytics summary (role-based)
- `GET    /api/analytics/categories` — Category breakdown (admin only)

### **Audit Logs (Admin Only)**
- `GET    /api/audit` — List audit logs (pagination, filters)
- `GET    /api/audit/stats` — Audit log statistics
- `GET    /api/audit/export` — Export audit logs to CSV

---

## Frontend Routes/Pages

- `/login` — Login page
- `/dashboard` — Dashboard (role-based stats)
- `/expenses` — Expense management
- `/analytics` — Analytics dashboard (admin only)
- `/audit-logs` — Audit log viewer (admin only)
- `/users` — User management (admin only)
- `/test-user` — Debug/test page for current user

---

## Dependencies

### **Backend**
- **express**: Web server framework
- **@prisma/client, prisma**: ORM and DB migrations
- **bcryptjs**: Password hashing
- **cors**: CORS middleware
- **csv-writer**: CSV export
- **dotenv**: Environment variable management
- **express-rate-limit**: Rate limiting
- **express-validator**: Request validation (legacy)
- **helmet**: Security headers
- **jsonwebtoken**: JWT auth
- **moment**: Date/time utilities
- **multer**: File uploads
- **zod**: Schema validation
- **jest, supertest**: Testing
- **nodemon**: Dev auto-reload

### **Frontend**
- **react, react-dom**: UI framework
- **react-router-dom**: Routing
- **axios**: HTTP requests
- **recharts**: Charts/analytics
- **tailwindcss, autoprefixer**: Styling
- **@heroicons/react, lucide-react**: Icons
- **react-hook-form, @hookform/resolvers**: Form handling
- **zod**: Schema validation
- **date-fns**: Date utilities
- **clsx, tailwind-merge**: Class utilities
- **vite, vitest**: Build/test
- **typescript**: Type safety
- **eslint**: Linting

---

## Environment Variables

### **Backend** (`backend/.env`)
- `DATABASE_URL` — PostgreSQL connection string
- `JWT_SECRET` — JWT signing key
- `PORT` — Server port
- `NODE_ENV` — Environment (development/production)
- `MAX_FILE_SIZE` — Max upload size (default 5MB)
- `UPLOAD_PATH` — Uploads directory
- `RATE_LIMIT_WINDOW_MS` — Rate limit window
- `RATE_LIMIT_MAX_REQUESTS` — Rate limit max

### **Frontend** (`frontend/.env`)
- `VITE_API_URL` — Backend API base URL
- `VITE_APP_TITLE` — App title
- `VITE_APP_VERSION` — App version

---

## Implementation Notes

- **RBAC**: Role-based access control enforced on backend and frontend. Employees see only their own data; admins see all.
- **Validation**: All major endpoints use Zod for schema validation.
- **File Uploads**: Receipts are uploaded via Multer, stored in `/uploads`, and served as static files.
- **Audit Logging**: All user/system actions are logged for compliance and traceability.
- **Security**: JWT auth, CORS, Helmet, rate limiting, and input validation throughout.
- **Testing**: Jest and Supertest for backend; Vitest for frontend.

---

## Setup & Development Notes

1. **Clone the repo** and install dependencies (`npm install` in both `backend` and `frontend`).
2. **Configure environment variables** in `.env` files.
3. **Run database migrations and seed** (`npm run db:setup` and `npm run db:seed` in backend).
4. **Start backend and frontend** (`npm run dev` in both).
5. **Access the app** at `http://localhost:3000` (frontend) and `http://localhost:5001` (backend API).
6. **Default users**: `admin@example.com` / `password123`, `employee@example.com` / `password123`.

---

## Contribution & Extension

- Follow code style and linting rules.
- Add/extend Zod schemas for new endpoints.
- Add new pages/components in `frontend/src/pages` and `frontend/src/components`.
- Add new API endpoints in `backend/src/routes` and update documentation.
- All changes should be tested and, if possible, covered by automated tests.

---

**For any questions, see the main README or contact the maintainers.** 